!function(a,b,c){function d(){return!(!a.AudioContext&&!a.webkitAudioContext)}function e(){if(e.audioTop)return e.audioTop;if(!d())return null;var b=new(a.AudioContext||a.webkitAudioContext);return e.audioTop={ac:b,out:null,currentStart:null},f(),e.audioTop}function f(){if(e.audioTop){var a=e.audioTop;a.out&&(a.out.disconnect(),a.out=null,a.currentStart=null);var b=a.ac.createDynamicsCompressor();b.ratio=16,b.attack=5e-4,b.connect(a.ac.destination),a.out=b}}function g(){var a=e();return null!=a.currentStart?a.currentStart:(a.currentStart=a.ac.currentTime,setTimeout(function(){a.currentStart=null},0),a.currentStart)}var h=!1,i=function(){function a(a){this._timbre=B(a),this._queue=[],this._minQueueTime=1/0,this._maxScheduledTime=0,this._unsortedQueue=!1,this._startSet=[],this._finishSet={},this._cleanupSet=[],this._callbackSet=[],this._handlers={},this._now=null,d()&&this.silence()}function b(a){function b(a){a=a||"",(a||p===m)&&(!a||p===m||p.id||p.stems&&p.stems.length?m.voice.hasOwnProperty(a)?(p=m.voice[a],r=p.accent):(p={id:a,accent:{}},m.voice[a]=p,r=p.accent):(delete m.voice[p.id],p.id=a,m.voice[a]=p,r=p.accent))}function d(){return m.V?m.V.split(/\s+/)[0]:""}var e,g,h,j,k=a.split("\n"),m={voice:{}},p=m,q={},r={};for(e=0;e<k.length;++e)if(g=D.exec(k[e])){switch(g[1]){case"V":p!==m&&b(g[2].split(" ")[0]);break;case"M":c(g[2],p);break;case"L":f(g[2],p);break;case"Q":i(g[2],p)}p.hasOwnProperty(g[1])?p[g[1]]+="\n"+g[2]:p[g[1]]=g[2],"K"==g[1]&&p===m&&(q=n(g[2]),b(d()))}else j={},h=o(k[e],q,r,j),j.voiceid&&b(j.voiceid),h&&h.length&&(p===m&&b(d()),"stems"in p||(p.stems=[]),p.stems.push.apply(p.stems,h));if(m.voice)for(e in m.voice)m.voice[e].stems&&l(m.voice[e].stems);return m}function c(a,b){var c=/^C/.test(a)?1:A(a);c&&(b.unitnote||(b.unitnote=.75>c?1/16:1/8))}function f(a,b){var c=A(a);c&&(b.unitnote=c)}function i(a,b){var c,d=a.split(/\s+|=/),e=null,f=null;for(c=0;c<d.length;++c)d[c].indexOf("/")>=0||/^[1-4]$/.test(d[c])?e=e||A(d[c]):f=f||Number(d[c]);e&&(b.unitbeat=e),f&&(b.tempo=f)}function l(a){var b,c,d,e,f,g={};for(c=0;c<a.length;++c){for(b={},d=0;d<a[c].note.length;++d)f=e=a[c].note[d],g.hasOwnProperty(e.pitch)&&(f=g[e.pitch],f.time+=e.time,e.holdover=!0),e.tie&&(b[e.pitch]=f);g=b}}function m(a){var b,c="FCGDAEB",d={};if(!a)return d;if(a>0)for(b=0;a>b&&7>b;++b)d[c.charAt(b)]="^";else for(b=0;b>a&&b>-7;--b)d[c.charAt(6+b)]="_";return d}function n(a){if(!a)return{};var b,c={"c#":7,"f#":6,b:5,e:4,a:3,d:2,g:1,c:0,f:-1,bb:-2,eb:-3,ab:-4,db:-5,gb:-6,cb:-7,"a#m":7,"d#m":6,"g#m":5,"c#m":4,"f#m":3,bm:2,em:1,am:0,dm:-1,gm:-2,cm:-3,fm:-4,bbm:-5,ebm:-6,abm:-7,"g#mix":7,"c#mix":6,"f#mix":5,bmix:4,emix:3,amix:2,dmix:1,gmix:0,cmix:-1,fmix:-2,bbmix:-3,ebmix:-4,abmix:-5,dbmix:-6,gbmix:-7,"d#dor":7,"g#dor":6,"c#dor":5,"f#dor":4,bdor:3,edor:2,ador:1,ddor:0,gdor:-1,cdor:-2,fdor:-3,bbdor:-4,ebdor:-5,abdor:-6,dbdor:-7,"e#phr":7,"a#phr":6,"d#phr":5,"g#phr":4,"c#phr":3,"f#phr":2,bphr:1,ephr:0,aphr:-1,dphr:-2,gphr:-3,cphr:-4,fphr:-5,bbphr:-6,ebphr:-7,"f#lyd":7,blyd:6,elyd:5,alyd:4,dlyd:3,glyd:2,clyd:1,flyd:0,bblyd:-1,eblyd:-2,ablyd:-3,dblyd:-4,gblyd:-5,cblyd:-6,fblyd:-7,"b#loc":7,"e#loc":6,"a#loc":5,"d#loc":4,"g#loc":3,"c#loc":2,"f#loc":1,bloc:0,eloc:-1,aloc:-2,dloc:-3,gloc:-4,cloc:-5,floc:-6,bbloc:-7};a=a.replace(/\s+/g,"").toLowerCase().substr(0,5);var d=a.match(/maj|min|mix|dor|phr|lyd|loc|m/);b=d?"maj"==d?a.substr(0,d.index):"min"==d?a.substr(0,d.index+1):a.substr(0,d.index+d.length):/^[a-g][#b]?/.exec(a)||"";var e=m(c[b]),f=a.substr(b.length).match(/(__|_|=|\^\^|\^)[a-g]/g);if(f)for(j=0;j<f.length;++j){var g=f[j].charAt(f[j].length-1).toUpperCase();"="==f[j].charAt(0)?delete e[g]:e[g]=f[j].substr(0,f[j].length-1)}return e}function o(a,b,c,d){var e,f=a.match(E),g=[],h=null,i=0,j=0,k=null;if(!f)return null;for(;i<f.length;)if(/^[\s%]/.test(f[i]))i++;else if(/^\[V:\S*\]$/.test(f[i]))d.voiceid=f[i].substring(3,f[i].length-1),i++;else if(/</.test(f[i]))j=-f[i++].length;else if(/>/.test(f[i]))j=f[i++].length;else if(/^\(\d+(?::\d+)*/.test(f[i]))k=r(f[i++]);else if(/^[!+].*[!+]$/.test(f[i]))s(f[i++],c);else if(/\|/.test(f[i])){for(e in c)1==e.length&&delete c[e];i++}else h=t(f,i,b,c),null!==h?null!==h&&(k&&(q(h.stem,k.time),k.count-=1,k.count||(k=null)),j&&g.length&&(e=j>0?(1-Math.pow(.5,j))*h.stem.time:(Math.pow(.5,-j)-1)*g[g.length-1].time,p(g[g.length-1],e),p(h.stem,-e)),j=0,g.push(h.stem),i=h.index):i++;return g}function p(a,b){var c,d=a.time,e=d+b;for(a.time=e,c=0;c<a.note.length;++c)note=a.note[c],note.time==d&&(note.time=e)}function q(a,b){var c;for(a.time*=b,c=0;c<a.note.length;++c)a.note[c].time*=b}function r(a){var b=/^\((\d+)(?::(\d+)(?::(\d+))?)?$/.exec(a);if(!b)return null;var c=Number(b[1]),d=Number(b[2])||2,e=Number(b[3])||c;return{time:d/c,count:e}}function s(a,b){if(!(a.length<2))switch(a=a.substring(1,a.length-1)){case"pppp":case"ppp":b.dynamics=.2;break;case"pp":b.dynamics=.4;break;case"p":b.dynamics=.6;break;case"mp":b.dynamics=.8;break;case"mf":b.dynamics=1;break;case"f":b.dynamics=1.2;break;case"ff":b.dynamics=1.4;break;case"fff":case"ffff":b.dynamics=1.5}}function t(a,b,c,d){var e,f,g,h,i=[],j="",k=!1,l=null,m=1/0;if(b<a.length&&"."==a[b]&&(k=!0,b++),b<a.length&&"["==a[b]){for(b++;b<a.length;)if(/^[\s%]/.test(a[b]))b++;else{if(/[A-Ga-g]/.test(a[b]))l={pitch:v(a[b++],c,d),tie:!1},l.frequency=z(l.pitch),i.push(l);else{if(!/[xzXZ]/.test(a[b])){if("."==a[b]){k=!0,b++;continue}break}l=null,b++}b<a.length&&/^(?![\s%!]).*[\d\/]/.test(a[b])?(e=a[b++],f=A(e)):(e="",f=1),l&&(l.duration=e,l.time=f),f&&m>f&&(j=e,m=f),b<a.length&&"-"==a[b]&&(l&&(i[i.length-1].tie=!0),b++)}if("]"!=a[b])return null;b++}else if(b<a.length&&/[A-Ga-g]/.test(a[b]))l={pitch:v(a[b++],c,d),tie:!1,duration:"",time:1},l.frequency=z(l.pitch),i.push(l);else{if(!(b<a.length&&/^[xzXZ]$/.test(a[b])))return null;b++}if(b<a.length&&/^(?![\s%!]).*[\d\/]/.test(a[b]))for(j=a[b++],f=A(j),h=0;h<i.length;++h)i[h].duration=j,i[h].time=f;if(b<a.length&&"-"==a[b])for(b++,h=0;h<i.length;++h)i[h].tie=!0;if(d.dynamics)for(g=d.dynamics,h=0;h<i.length;++h)i[h].velocity=g;return{index:b,stem:{note:i,duration:j,staccato:k,time:A(j)}}}function u(a){return a.length>0&&"="==a.charAt(0)?a.substr(1):a}function v(a,b,c){var d,e=/^(\^\^|\^|__|_|=|)([A-Ga-g])(.*)$/.exec(a);return e?(d=e[2].toUpperCase(),e[1].length>0?(c[d]=e[1],u(a)):u(c.hasOwnProperty(d)?c[d]+e[2]+e[3]:b.hasOwnProperty(d)?b[d]+e[2]+e[3]:a)):a}function w(a){return 440*Math.pow(2,(a-69)/12)}function x(a){return Math.round(69+12*Math.log(a/440)/Math.LN2)}function y(a){var b=/^(\^\^|\^|__|_|=|)([A-Ga-g])([,']*)$/.exec(a);if(!b)return null;var c={C:0,D:2,E:4,F:5,G:7,A:9,B:11,c:12,d:14,e:16,f:17,g:19,a:21,b:23},d={"^^":2,"^":1,"":0,"=":0,_:-1,__:-2},e=b[3].replace(/,/g,"").length-b[3].replace(/'/g,"").length,f=c[b[2]]+d[b[1]]+12*e;return f+60}function z(a){return w(y(a))}function A(a){var b,c,d,e=/^(\d*)(?:\/(\d*))?$|^(\/+)$/.exec(a),f=0;if(e){if(e[3])return Math.pow(.5,e[3].length);for(c=e[2]?parseFloat(e[2]):/\//.test(a)?2:1,d=0,b=e[1]?parseFloat(e[1]):1;d+1<e[1].length&&b>c;)d+=1,f=parseFloat(e[1].substring(0,d)),b=parseFloat(e[1].substring(d));return f+b/c}}function B(a){a||(a={}),"string"==typeof a&&(a={wave:a});var b,c={},d=G[a.wave];for(b in F)c[b]=a.hasOwnProperty(b)?a[b]:d&&d.defs&&d.defs.hasOwnProperty(b)?d.defs[b]:F[b];return c}function C(a,b,c){var d=a.createOscillator();try{if(G.hasOwnProperty(b)){if(pwave=G[b].wave,G[b].freq){bwf=0;for(k in G[b].freq)wf=Number(k),c>wf&&wf>bwf&&(bwf=wf,pwave=G[b].freq[bwf])}d.setPeriodicWave(pwave)}else d.type=b}catch(e){window.console&&window.console.log(e),d.type="square"}return d.frequency.value=c,d}a.dequeueTime=.5,a.bufferSecs=2,a.toneLength=10,a.cleanupDelay=.1,a.prototype.setTimbre=function(a){this._timbre=B(a)},a.prototype.getTimbre=function(){return B(this._timbre)},a.prototype.setVolume=function(a){this._out&&(isNaN(a)||(this._out.gain.value=a))},a.prototype.getVolume=function(){return this._out?this._out.gain.value:0},a.prototype.silence=function(){var a,b,c,d=1;this._queue.length=0,this._minQueueTime=1/0,this._maxScheduledTime=0,this._startSet.length=0,b=this._finishSet,this._finishSet={},c=this._callbackSet,this._callbackSet=[],this._out&&(this._out.disconnect(),d=this._out.gain.value),this._atop=e(),this._out=this._atop.ac.createGain(),this._out.gain.value=d,this._out.connect(this._atop.out);for(a in b)this._trigger("noteoff",b[a]);for(a=0;a<c.length;++a)c[a].callback()},a.prototype.now=function(){return null!=this._now?this._now:(this._startPollTimer(!0),this._now=g(),this._now)},a.prototype.on=function(a,b){this._handlers.hasOwnProperty(a)||(this._handlers[a]=[]),this._handlers[a].push(b)},a.prototype.off=function(a,b){if(this._handlers.hasOwnProperty(a))if(b){var c,d=this._handlers[a];for(c=0;c<d.length;++c)d[c]===b&&(d.splice(c,1),c-=1)}else this._handlers[a]=[]},a.prototype._trigger=function(a,b){var c,d=this._handlers[a];if(d){if(1==d.length)return void d[0](b);for(d=d.slice(),c=0;c<d.length;++c)d[c](b)}},a.prototype._makeSound=function(a){var b,c,d,e,f=a.timbre||this._timbre,g=a.time,h=g+a.duration,i=Math.min(h,g+f.attack),j=i,k=h+f.release,l=f.detune&&1!=f.detune,m=f.gain*a.velocity*(l?.5:1),n=this._atop.ac;if(a.duration>0&&a.velocity>0){for(b=n.createGain(),b.gain.setValueAtTime(0,g),b.gain.linearRampToValueAtTime(m,i);i+1/32>j&&h>j+1/256;)j+=1/256,b.gain.linearRampToValueAtTime(m*(f.sustain+(1-f.sustain)*Math.exp((i-j)/f.decay)),j);b.gain.setTargetAtTime(m*f.sustain,j,f.decay),b.gain.setValueAtTime(m*(f.sustain+(1-f.sustain)*Math.exp((i-h)/f.decay)),h),b.gain.linearRampToValueAtTime(0,k),b.connect(this._out),!f.cutoff&&!f.cutfollow||1/0==f.cutoff?c=b:(c=n.createBiquadFilter(),c.frequency.value=f.cutoff+a.frequency*f.cutfollow,c.Q.value=f.resonance,c.connect(b)),d=C(n,f.wave,a.frequency),d.connect(c),d.start(g),d.stop(k),l&&(e=C(n,f.wave,a.frequency*f.detune),e.connect(c),e.start(g),e.stop(k)),a.gainNode=b,a.oscillators=[d],l&&a.oscillators.push(e),a.cleanuptime=k}else a.duration=0;this._startSet.push(a)},a.prototype._truncateSound=function(b,c){if(c<b.time+b.duration&&(b.duration=Math.max(0,c-b.time),b.gainNode)){var d,e=b.timbre||this._timbre,f=b.time,g=Math.min(c,f+e.attack),h=c+e.release,i=h+a.cleanupDelay,j=e.detune&&1!=e.detune,k=e.gain*b.velocity*(j?.5:1),l=b.gainNode;if(l.gain.cancelScheduledValues(c),f>=c?l.gain.setValueAtTime(0,c):g>=c?l.gain.linearRampToValueAtTime(k*(c-f)/(g-f)):l.gain.setValueAtTime(k*(e.sustain+(1-e.sustain)*Math.exp((g-c)/e.decay)),c),l.gain.linearRampToValueAtTime(0,h),b.oscillators)for(d=0;d<b.oscillators.length;++d)b.oscillators[d].stop(h);b.cleanuptime=i}},a.prototype._doPoll=function(){if(this._pollTimer=null,this._now=null,h)return void this.silence();var b,c,d,e,f,g,i,j=this._atop.ac.currentTime;if(this._minQueueTime-j<=a.bufferSecs){for(this._unsortedQueue&&(this._queue.sort(function(a,b){return a.time!=b.time?a.time-b.time:a.duration!=b.duration?a.duration-b.duration:a.frequency-b.frequency}),this._unsortedQueue=!1),b=0;b<this._queue.length&&!(this._queue[b].time-j>a.bufferSecs);++b);if(b>0){for(c=this._queue.splice(0,b),b=0;b<c.length;++b)this._makeSound(c[b]);this._minQueueTime=this._queue.length>0?this._queue[0].time:1/0}}for(b=0;b<this._cleanupSet.length;++b)f=this._cleanupSet[b],f.cleanuptime<j&&(f.gainNode&&(f.gainNode.disconnect(),f.gainNode=null),this._cleanupSet.splice(b,1),b-=1);for(e in this._finishSet)f=this._finishSet[e],d=f.time+f.duration,j>=d&&(this._trigger("noteoff",f),1/0!=f.cleanuptime&&this._cleanupSet.push(f),delete this._finishSet[e]);for(b=0;b<this._callbackSet.length;++b)this._callbackSet[b].time<=j&&(this._callbackSet[b].callback(),this._callbackSet.splice(b,1),b-=1);for(b=0;b<this._startSet.length;++b)this._startSet[b].time<=j&&(i=f=this._startSet[b],e=f.frequency,g=null,this._finishSet.hasOwnProperty(e)&&(g=this._finishSet[e],g.time<f.time||g.time==f.time&&g.duration<f.duration?(this._truncateSound(g,f.time),this._trigger("noteoff",g),delete this._finishSet[e]):(this._truncateSound(f,g.time),g=f)),this._startSet.splice(b,1),b-=1,f.duration>0&&f.velocity>0&&g!==f&&(this._finishSet[e]=f,this._trigger("noteon",f)));this._startPollTimer()},a.prototype._startPollTimer=function(b){var c,d,e=this,f=1/0;if(this._pollTimer){if(null!=this._now)return;clearTimeout(this._pollTimer),this._pollTimer=null}if(b)f=0;else{for(c=0;c<this._startSet.length;++c)f=Math.min(f,this._startSet[c].time);for(c in this._finishSet)f=Math.min(f,this._finishSet[c].time+this._finishSet[c].duration);for(c=0;c<this._callbackSet.length;++c)f=Math.min(f,this._callbackSet[c].time);this._cleanupSet.length>0&&(f=Math.min(f,this._cleanupSet[0].cleanuptime+1)),f=Math.min(f,this._minQueueTime-a.dequeueTime)}d=Math.max(0,f-this._atop.ac.currentTime),isNaN(d)||1/0==d||(this._pollTimer=setTimeout(function(){e._doPoll()},Math.round(1e3*d)))},a.prototype.tone=function(b,c,d,e,f){if(this._atop){var g,h;b||(b="C"),isNaN(b)?(g=y(b),h=w(g)):(h=Number(b),0>h?(g=-h,h=w(g)):g=x(h));var i=(this._atop.ac,this.now()),j=i+(e||0),k={time:j,on:!1,frequency:h,midi:g,velocity:null==c?1:c,duration:null==d?a.toneLength:d,timbre:f,instrument:this,gainNode:null,oscillators:null,cleanuptime:1/0};j<i+a.bufferSecs?this._makeSound(k):(!this._unsortedQueue&&this._queue.length&&j<this._queue[this._queue.length-1].time&&(this._unsortedQueue=!0),this._queue.push(k),this._minQueueTime=Math.min(this._minQueueTime,k.time))}},a.prototype.schedule=function(a,b){this._callbackSet.push({time:this.now()+a,callback:b})},a.prototype.play=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=Array.prototype.slice.call(arguments),s=null,t={},u=0,v=[];if(r.length&&"function"==typeof r[r.length-1]&&(s=r.pop()),!this._atop)return void(s&&s());if(d=0,"object"==typeof r[0]){for(f in r[0])r[0].hasOwnProperty(f)&&(t[f]=r[0][f]);d=1}for(;d<r.length;++d)for(a=r[d].split(/\n(?=X:)/),f=0;f<a.length;++f)c=b(a[f]),c&&(!t.tempo&&c.tempo&&(t.tempo=c.tempo,c.unitbeat&&(t.tempo*=c.unitbeat/(c.unitnote||1))),c.voice&&v.push(c));for(t.tempo||(t.tempo=120),o=60/t.tempo,f=0;f<v.length;++f){c=v[f];for(k in c.voice)if(e=B(t.timbre||c.voice[k].timbre||c.timbre||this._timbre),i=c.voice[k].stems){for(g=0,j=0;j<i.length;++j){for(m=i[j],h=1/Math.sqrt(m.note.length),l=0;l<m.note.length;++l)n=m.note[l],n.holdover||(p=(n.time||m.time)*o,m.staccato&&(p=Math.min(Math.min(p,o/16),e.attack+e.decay)),q=(n.velocity||1)*h,this.tone(n.pitch,q,p,g,e));g+=m.time*o}u=Math.max(g,u)}}this._maxScheduledTime=Math.max(this._maxScheduledTime,this.now()+u),s&&this.schedule(u,s)};var D=/^([A-Za-z]):\s*(.*)$/,E=/(?:^\[V:[^\]\s]*\])|\s+|%[^\n]*|![^\s!:|\[\]]*!|\+[^+|!]*\+|\[|\]|>+|<+|(?:(?:\^\^|\^|__|_|=|)[A-Ga-g](?:,+|'+|))|\(\d+(?::\d+){0,2}|\d*\/\d+|\d+\/?|\/+|[xzXZ]|\[?\|\]?|:?\|:?|::|./g,F={wave:"square",gain:.1,attack:.002,decay:.4,sustain:0,release:.1,cutoff:0,cutfollow:0,resonance:0,detune:0},G=function(a){function b(a,b){var c,d=b.real.length,e=new Float32Array(d),f=new Float32Array(d);for(c=0;d>c;++c)e[c]=b.real[c],f[c]=b.imag[c];return a.createPeriodicWave(e,f)}function c(a,b,c){var d,e,f={real:[],imag:[]},g=a.real.length;for(d=0;g>d;++d)e=Math.log(b[Math.min(d,b.length-1)]),f.real.push(a.real[d]*Math.exp(c*e)),f.imag.push(a.imag[d]*Math.exp(c*e));return f}if(!d())return{};var f,g,h,i,j,k={},l=e().ac;for(f in a){if(j=k[f]={},g=a[f],j.wave=b(l,g),g.mult)for(i=a[f].freq,j.freq={},h=0;h<i.length;++h)j.freq[i[h]]=b(l,c(g,g.mult,(h+1)/i.length));g.defs&&(j.defs=g.defs)}return k}({piano:{real:[0,0,-.203569,.5,-.401676,.137128,-.104117,.115965,-.004413,.067884,-.00888,.0793,-.038756,.011882,-.030883,.027608,-.013429,.00393,-.014029,.00972,-.007653,.007866,-.032029,.046127,-.024155,.023095,-.005522,.004511,-.003593,.011248,-.004919,.008505],imag:[0,.147621,0,7e-6,-1e-5,5e-6,-6e-6,9e-6,0,8e-6,-1e-6,14e-6,-8e-6,3e-6,-9e-6,9e-6,-5e-6,2e-6,-7e-6,5e-6,-5e-6,5e-6,-23e-6,37e-6,-21e-6,22e-6,-6e-6,5e-6,-4e-6,14e-6,-7e-6,12e-6],mult:[1,1,.18,.016,.01,.01,.01,.004,.014,.02,.014,.004,.002,1e-5],freq:[65,80,100,135,180,240,620,1360],defs:{wave:"piano",gain:.3,attack:.002,decay:.4,sustain:.005,release:.1,cutoff:800,cutfollow:.1,resonance:1,detune:1.001}}});return a}(),l={Instrument:i};if(b&&b.exports)b.exports=l;else if(c&&c.amd)c(function(){return l});else for(var m in l)a[m]=l[m]}(this,"object"==typeof module&&module,"function"==typeof define&&define);